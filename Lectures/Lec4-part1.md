# Page Table-PART1⃣️

> 这部分主题是页表，对于虚拟内存的其他内容会在后面详细介绍。

首先明确，虚拟内存的主要目的是实现**内存的强隔离性**。如果正确的设置page table并对其进行管控，即可实现强隔离。这个强隔离是指，每个程序的内存独立，互不影响，且用户空间的程序不会影响内核空间的程序。

## 地址空间（Address Spaces）

要实现一种机制，将不同程序内存隔离起来，一种方式就是**地址空间**。

<img src="/Users/liuwenshuo/Documents/Notes/6.s801/Lectures/image-20220415220028104.png" alt="image-20220415220028104" style="zoom:33%;" />

我们给**包括内核在内**的所有程序专属、独立的地址空间。这样如果shell向地址1000写入数据，只会写入自己的地址1000，而不是公用的地址1000。

但问题在于**如何在一个物理内存上，创建不同的地址空间**？

## 页表

最灵活的方式就是实现**页表**。页表是在硬件中通过处理器和MMU（Memory Management Unit 内存管理单元）实现。

<img src="/Users/liuwenshuo/Documents/Notes/6.s801/Lectures/image-20220415221017342.png" alt="image-20220415221017342" style="zoom: 33%;" />

实现页表后，在所有的程序中涉及到的地址，均为**虚拟地址**。例如sd $7, (a0)，其中a0中地址为0x1000，这个就是当前程序的0x1000。需要通过MMU进行虚拟地址到物理地址的映射。

注意，虚拟地址-物理地址 的映射，也保存在内存中。因此CPU需要有寄存器用来存放页表在物理内存中的首地址。RISC-V中的SATP寄存器就保存了这个地址的首地址。